<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/login/join_second.css">
    <title>회원가입</title>
</head>
<body>
<div id="root">
    <main>
        <header class="Header-module_container__da545">
            <div class="Header-module_content__31d4e">
                <div class="Header-module_left__45013">
                    <button type="button" aria-label="뒤로 가기">
                        <!-- SVG 생략 -->
                    </button>
                </div>
                <div class="Header-module_center__3afb0"></div>
                <div class="Header-module_right__6c908">
                    <a href="/web/main" aria-label="홈으로 가기">
                        <!-- SVG 생략 -->
                    </a>
                </div>
            </div>
        </header>

        <div class="padding-16">
            <div class="SignupForm-module_container__7536d">
                <div class="SignupForm-module_titleContainer__fb197">
                    <div class="SignupForm-module_title__d581c">이메일 가입하기</div>
                    <span class="SignupForm-module_description__3422b">최소한의 정보를 받고 있어요.</span>
                </div>

                <div class="SignupForm-module_content__a4f9d">

                    <!-- ✅ form action 수정 -->
                    <form action="/login/join_second" method="post">

                        <!-- 이메일 -->
                        <div class="EmailAuthField-module_emailAuthField__1a4fe">
                            <label>이메일 <span>*</span></label>
                            <input type="hidden" name="memberEmail" th:value="${email}">
                            <input type="text" th:value="${email}" disabled>
                        </div>

                        <!-- 비밀번호 -->
                        <div class="TextField-module_textField__404b4">
                            <label>비밀번호 <span>*</span></label>
                            <input type="password" name="memberPassword" id="memberPassword" placeholder="비밀번호 입력">
                            <span id="passwordError" style="color:red"></span>
                        </div>

                        <!-- 비밀번호 확인 -->
                        <div class="TextField-module_textField__404b4">
                            <label>비밀번호 확인 <span>*</span></label>
                            <input type="password" name="verifyPassword" id="verifyPassword" placeholder="비밀번호 확인">
                            <span id="verifyPasswordError" style="color:red"></span>
                        </div>

                        <!-- 이름 -->
                        <div class="TextField-module_textField__404b4">
                            <label>이름 <span>*</span></label>
                            <input type="text" name="memberName" id="memberName" placeholder="이름 입력">
                        </div>

                        <!-- 주소 -->
                        <div class="TextField-module_textField__404b4">
                            <label>주소 입력 <span>*</span></label>
                            <input type="text" id="addressInput" name="memberAddress" placeholder="주소를 입력하세요" readonly onclick="sample4_execDaumPostcode();">
                        </div>

                        <button type="submit" id="submitBtn" disabled>약관 동의 후 가입 완료하기</button>

                    </form>

                </div>
            </div>
        </div>
    </main>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const passwordInput = document.getElementById('memberPassword');
        const verifyPasswordInput = document.getElementById('verifyPassword');
        const memberNameInput = document.getElementById('memberName');
        const addressInput = document.getElementById('addressInput');
        const submitButton = document.getElementById('submitBtn');
        const passwordError = document.getElementById('passwordError');
        const verifyPasswordError = document.getElementById('verifyPasswordError');

        const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;

        function validatePassword() {
            if (!passwordRegex.test(passwordInput.value)) {
                passwordInput.style.border = "1px solid #f66";
                passwordError.textContent = "영어, 숫자, 특수문자 포함 8자 이상";
                return false;
            }
            passwordInput.style.border = "";
            passwordError.textContent = "";
            return true;
        }

        function validateVerifyPassword() {
            if (verifyPasswordInput.value !== passwordInput.value) {
                verifyPasswordInput.style.border = "1px solid #f66";
                verifyPasswordError.textContent = "비밀번호가 일치하지 않습니다.";
                return false;
            }
            verifyPasswordInput.style.border = "";
            verifyPasswordError.textContent = "";
            return true;
        }

        function updateSubmitButton() {
            const allValid = validatePassword() && validateVerifyPassword() && memberNameInput.value.trim() && addressInput.value.trim();
            submitButton.disabled = !allValid;
        }

        passwordInput.addEventListener('input', updateSubmitButton);
        verifyPasswordInput.addEventListener('input', updateSubmitButton);
        memberNameInput.addEventListener('input', updateSubmitButton);
        addressInput.addEventListener('change', updateSubmitButton);
    });
</script>

<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
    function sample4_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                const addressInput = document.getElementById("addressInput");
                addressInput.value = data.roadAddress;
                addressInput.dispatchEvent(new Event('change'));
            }
        }).open();
    }
</script>

</body>
</html>
